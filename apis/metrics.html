<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.1.0 中文文档: Metrics</title>
    <link rel="shortcut icon" href="/1.1.0/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/1.1.0/page/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/1.1.0/page/css/flink.css">
    <link rel="stylesheet" href="/1.1.0/page/css/syntax.css">
    <link rel="stylesheet" href="/1.1.0/page/css/codetabs.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    
    
    <div style="position:fixed; bottom:0; left:0; z-index:99999; width:100%; text-align:center; padding:15px; border-top:1px dashed #CE4B65; background:#f6f0e3; font-weight:bold">
       本文档适用于 Apache Flink 的旧版本，建议使用 <a href="http://doc.flink-china.org/latest/">最新版本的文档</a> 。
    </div>
    
    

    
    





    <!-- Top navbar. -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="http://flink-china.org"><img alt="Apache Flink" src="/1.1.0/page/img/navbar-brand-logo.jpg"></a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="hidden-sm "><a href="/1.1.0/">中文文档 1.1</a></li>

            <li class="hidden-sm "><a href="/1.1.0/features.html">特性</a></li>

            <!-- Quickstart -->
            <li class="dropdown">
              <a href="/1.1.0/quickstart" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">快速起步<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/1.1.0/quickstart/setup_quickstart.html">安装</a></li>
                
                <li class=""><a href="/1.1.0/quickstart/run_example_quickstart.html">例子: 维基百科编辑流</a></li>
                
                <li class=""><a href="/1.1.0/quickstart/java_api_quickstart.html">Java API</a></li>
                
                <li class=""><a href="/1.1.0/quickstart/scala_api_quickstart.html">Scala API</a></li>
                
              </ul>
            </li>

            <!-- Setup -->
            <li class="dropdown">
              <a href="/1.1.0/setup" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">安装 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/1.1.0/setup/building.html">构建 Flink</a></li>
                
                <li class=""><a href="/1.1.0/setup/config.html">Configuration</a></li>
                

                <li class="divider"></li>
                <li role="presentation" class="dropdown-header"><strong>部署</strong></li>
                
                
                <li class=""><a href="/1.1.0/setup/local_setup.html">本地</a></li>
                
                <li class=""><a href="/1.1.0/setup/cluster_setup.html">集群 (Standalone)</a></li>
                
                <li class=""><a href="/1.1.0/setup/yarn_setup.html">YARN</a></li>
                
                <li class=""><a href="/1.1.0/setup/gce_setup.html">Google Compute Engine</a></li>
                
                <li class=""><a href="/1.1.0/setup/jobmanager_high_availability.html">High Availability</a></li>
                
              </ul>
            </li>

            <!-- Programming Guides -->
            <li class="dropdown active">
              <a href="/1.1.0/apis" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">编程指南 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                
                
                <li class=""><a href="/1.1.0/apis/common/"><strong>基本概念</strong></a></li>
                
                <li class=""><a href="/1.1.0/apis/streaming/"><strong>Streaming 指南</strong> (DataStream API)</a></li>
                
                <li class=""><a href="/1.1.0/apis/batch/"><strong>Batch 指南</strong> (DataSet API)</a></li>
                
                <li class=""><a href="/1.1.0/apis/best_practices.html">Best Practices</a></li>
                
                <li class=""><a href="/1.1.0/apis/cli.html">命令行接口（CLI）</a></li>
                
                <li class=""><a href="/1.1.0/apis/local_execution.html">本地执行</a></li>
                
                <li class=""><a href="/1.1.0/apis/cluster_execution.html">Cluster Execution</a></li>
                
                <li class=""><a href="/1.1.0/apis/scala_shell.html">Scala Shell</a></li>
                
                <li class=""><a href="/1.1.0/apis/java8.html">Java 8</a></li>
                
                <li class="active"><a href="/1.1.0/apis/metrics.html">Metrics</a></li>
                
              </ul>
            </li>

            <!-- Libraries -->
            <li class="dropdown">
              <a href="/1.1.0/libs" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">类库 <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  
                  
                  <li class=""><a href="/1.1.0/apis/batch/libs/gelly.html">Graphs: Gelly</a></li>
                  
                  <li class=""><a href="/1.1.0/apis/streaming/libs/cep.html">CEP</a></li>
                  
                  <li class=""><a href="/1.1.0/apis/batch/libs/ml/">Machine Learning</a></li>
                  
                  <li class=""><a href="/1.1.0/apis/batch/libs/table.html">Relational: Table</a></li>
                  
              </ul>
            </li>

            <!-- Internals -->
            <li class="dropdown">
              <a href="/1.1.0/internals" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">内部 <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li role="presentation" class="dropdown-header"><strong>Contribute</strong></li>
                <li><a href="http://flink.apache.org/how-to-contribute.html"><small><span class="glyphicon glyphicon-new-window"></span></small> How to Contribute</a></li>
                <li><a href="http://flink.apache.org/contribute-code.html#coding-guidelines"><small><span class="glyphicon glyphicon-new-window"></span></small> Coding Guidelines</a></li>
                
                
                <li class=""><a href="/1.1.0/internals/ide_setup.html">IDE Setup</a></li>
                
                <li class=""><a href="/1.1.0/internals/logging.html">Logging</a></li>
                
                <li class=""><a href="/1.1.0/internals/general_arch.html">Architecture and Process Model</a></li>
                
                <li class=""><a href="/1.1.0/internals/stream_checkpointing.html">Data Streaming的容错机制</a></li>
                
                <li class=""><a href="/1.1.0/internals/types_serialization.html">Type Extraction and Serialization</a></li>
                
                <li class=""><a href="/1.1.0/internals/monitoring_rest_api.html">Monitoring REST API</a></li>
                
                <li class=""><a href="/1.1.0/internals/job_scheduling.html">Jobs and Scheduling</a></li>
                
                <li class=""><a href="/1.1.0/internals/add_operator.html">How-To: Add an Operator</a></li>
                
              </ul>
            </li>

          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a class="hidden-sm" href="http://blog.flink-china.org" target="_blank">
            <small><span class="glyphicon glyphicon-new-window"></span></small> 博客</a></li>
            <li class="hidden-sm "><a href="/1.1.0/about/">关于本站</a></li>
          </ul>
          <form class="navbar-form navbar-right hidden-sm hidden-md" role="search" action="/1.1.0/search-results.html">
            <div class="form-group">
              <input type="text" class="form-control" size="16px" name="q" placeholder="Search all pages">
            </div>
            <button type="submit" class="btn btn-default">搜索</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container -->
    </nav>


    

    <!-- Main content. -->
    <div class="container">
      
      
<div class="row">

  
  
  <div class="col-md-8 col-md-offset-2 text">
    <!-- Artifact name change warning. Remove for the 1.0 release. -->
    
    <div class="panel panel-default">
      <div class="panel-body"><strong>重要</strong>: 依赖于Scala的maven artifacts现在会添加一个Scala主版本的后缀，例如 "2.10" 或 "2.11". 请查阅<a href="https://cwiki.apache.org/confluence/display/FLINK/Maven+artifact+names+suffixed+with+Scala+version">迁移指南</a>.</div>
    </div>
    

    <h1>Metrics</h1>


<p>Flink 提供了一个metric系统帮助收集和提供给其他组件.</p>

<ul id="markdown-toc">
  <li><a href="#注册-metrics" id="markdown-toc-注册-metrics">注册 metrics</a>    <ul>
      <li><a href="#metric-类型" id="markdown-toc-metric-类型">Metric 类型</a></li>
    </ul>
  </li>
  <li><a href="#scope" id="markdown-toc-scope">Scope</a>    <ul>
      <li><a href="#用户-scope" id="markdown-toc-用户-scope">用户 Scope</a></li>
      <li><a href="#系统-scope" id="markdown-toc-系统-scope">系统 Scope</a></li>
      <li><a href="#所有变量列表" id="markdown-toc-所有变量列表">所有变量列表</a></li>
    </ul>
  </li>
  <li><a href="#reporter" id="markdown-toc-reporter">Reporter</a>    <ul>
      <li><a href="#jmx-orgapacheflinkmetricsjmxjmxreporter" id="markdown-toc-jmx-orgapacheflinkmetricsjmxjmxreporter">JMX (org.apache.flink.metrics.jmx.JMXReporter)</a></li>
      <li><a href="#ganglia-orgapacheflinkmetricsgangliagangliareporter" id="markdown-toc-ganglia-orgapacheflinkmetricsgangliagangliareporter">Ganglia (org.apache.flink.metrics.ganglia.GangliaReporter)</a></li>
      <li><a href="#graphite-orgapacheflinkmetricsgraphitegraphitereporter" id="markdown-toc-graphite-orgapacheflinkmetricsgraphitegraphitereporter">Graphite (org.apache.flink.metrics.graphite.GraphiteReporter)</a></li>
      <li><a href="#statsd-orgapacheflinkmetricsstatsdstatsdreporter" id="markdown-toc-statsd-orgapacheflinkmetricsstatsdstatsdreporter">StatsD (org.apache.flink.metrics.statsd.StatsDReporter)</a></li>
    </ul>
  </li>
  <li><a href="#系统-metrics" id="markdown-toc-系统-metrics">系统 metrics</a></li>
</ul>

<h2 id="注册-metrics">注册 metrics</h2>

<p>你可以通过任何继承 RichFunction 类的方法来得到 metric, 只需要调用 getRuntimeContext().getMetricGroup(). 这个方法可以返回一个创建和注册新 metrics 的 MetricGroup 对象.</p>

<h3 id="metric-类型">Metric 类型</h3>

<p>Flink 提供给 Counters, Gauges 和 Histogram 类型.</p>

<h4 id="counter">Counter</h4>

<p>Counter 使用来提供统计一些东西. 当前的 Counter 值可以使用 inc()/inc(long n) 或者 dec()/dec(long n) 来增加或减少. 你可以通过使用 MetricGroup 的counter(String name)方法创建或者注册一个 Counter.</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMapper</span> <span class="kd">extends</span> <span class="n">RichMapFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Counter</span> <span class="n">counter</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">counter</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
      <span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;myCounter&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@public</span> <span class="n">Integer</span> <span class="nf">map</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">counter</span><span class="o">.</span><span class="na">inc</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>或者你也可以使用你自己的 Counter 来实现:</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMapper</span> <span class="kd">extends</span> <span class="n">RichMapFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Counter</span> <span class="n">counter</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">counter</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
      <span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;myCustomCounter&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">CustomCounter</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<h4 id="gauge">Gauge</h4>

<p>Gauge 可以提供任何类型的值. 如果你要使用 Gauge 你必须通过继承 org.apache.flink.metrics.Gauge 接口创建自己的类. 对于返回的类型没有严格的限制. 可以通过调用 MetricGroup 的 gauge(String name, Gauge gauge) 来注册一个 gauge.</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMapper</span> <span class="kd">extends</span> <span class="n">RichMapFunction</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">valueToExpose</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">getRuntimeContext</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
      <span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">&quot;MyGauge&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Gauge</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">valueToExpose</span><span class="o">;</span>
        <span class="o">}</span>
      <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>注意 reporter 会把这个对象转为 String, 所以有必要实现 toString() 方法.</p>

<h4 id="histogram">Histogram</h4>

<p>Histogram 可以用来表示值的分布情况. 你可以通过 MetricGroup 的 histogram(String name, Histogram histogram) 来注册.</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMapper</span> <span class="kd">extends</span> <span class="n">RichMapFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Histogram</span> <span class="n">histogram</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">histogram</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
      <span class="o">.</span><span class="na">histogram</span><span class="o">(</span><span class="s">&quot;myHistogram&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">MyHistogram</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="nd">@public</span> <span class="n">Integer</span> <span class="nf">map</span><span class="o">(</span><span class="n">Long</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">histogram</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>Flink 并没有一个默认的 Histogram 的实现, 但是提供了一个 <a href="https://github.com/apache/flink/blob/master/flink-metrics/flink-metrics-dropwizard/src/main/java/org/apache/flink/dropwizard/metrics/DropwizardHistogramWrapper.java">Wrapper</a> 来使用 Codahale/DropWizard histograms. 使用这个 wrapper 你需要在 pom.xml里添加如下依赖:</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>flink-metrics-dropwizard<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>你可以像这样注册一个 Codahale/DropWizard histogram:</p>

<div class="highlight"><pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMapper</span> <span class="kd">extends</span> <span class="n">RichMapFunction</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">Histogram</span> <span class="n">histogram</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">open</span><span class="o">(</span><span class="n">Configuration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">com</span><span class="o">.</span><span class="na">codahale</span><span class="o">.</span><span class="na">metrics</span><span class="o">.</span><span class="na">Histogram</span> <span class="n">histogram</span> <span class="o">=</span>
      <span class="k">new</span> <span class="n">com</span><span class="o">.</span><span class="na">codahale</span><span class="o">.</span><span class="na">metrics</span><span class="o">.</span><span class="na">Histogram</span><span class="o">(</span><span class="k">new</span> <span class="nf">SlidingWindowReservoir</span><span class="o">(</span><span class="mi">500</span><span class="o">));</span>

    <span class="k">this</span><span class="o">.</span><span class="na">histogram</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
      <span class="o">.</span><span class="na">histogram</span><span class="o">(</span><span class="s">&quot;myHistogram&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="nf">DropWizardHistogramWrapper</span><span class="o">(</span><span class="n">histogram</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<h2 id="scope">Scope</h2>

<p>每个 metric 的标识符是由3个部分组成的: 用户注册 metric 时提供的名字, 一个可选择的用户定义 scope 和 系统提供的 scope. 例如, 如果 A.B 是系统 scope, C.D 为用户scope 而 E 是它的名字, 那么它的标识符见鬼标记为 A.B.C.D.E.</p>

<p>你可以通过设置 conf/flink-conf.yaml 里的 metrics.scope.delimiter 值来设置分隔符(默认:,).</p>

<h3 id="用户-scope">用户 Scope</h3>

<p>你可以通过调用 MetricGroup#addGroup(String name) 或者 MetricGroup#addGroup(int name) 来定义用户 scope.</p>

<div class="highlight"><pre><code class="language-java"><span class="n">counter</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">()</span>
  <span class="o">.</span><span class="na">getMetricGroup</span><span class="o">()</span>
  <span class="o">.</span><span class="na">addGroup</span><span class="o">(</span><span class="s">&quot;MyMetrics&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;myCounter&quot;</span><span class="o">);</span></code></pre></div>

<h3 id="系统-scope">系统 Scope</h3>

<p>系统 scoper 将包含此 metric 的上下文信息, 例如哪一个 task 被注册了或者 task 属于哪一个 job.</p>

<p>在 conf/flink-conf.yaml 里可以设置添加哪些上下文信息. 每个 key 都可以包含一些常量(例如 “taskmanager”)和一些变量(例如 “&lt;task_id&gt;”), 变量将会在运行时被替换.</p>

<ul>
  <li>metrics.scope.jm
    <ul>
      <li>默认: &lt;host&gt;.jobmanager</li>
      <li>Applied to all metrics that were scoped to a job manager.</li>
    </ul>
  </li>
  <li>metrics.scope.jm.job
    <ul>
      <li>默认: &lt;host&gt;.jobmanager.&lt;job_name&gt;</li>
      <li>Applied to all metrics that were scoped to a job manager and job.</li>
    </ul>
  </li>
  <li>metrics.scope.tm
    <ul>
      <li>默认: &lt;host&gt;.taskmanager.&lt;tm_id&gt;</li>
      <li>Applied to all metrics that were scoped to a task manager.</li>
    </ul>
  </li>
  <li>metrics.scope.tm.job
    <ul>
      <li>默认: &lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;</li>
      <li>Applied to all metrics that were scoped to a task manager and job.</li>
    </ul>
  </li>
  <li>metrics.scope.tm.task
    <ul>
      <li>默认: &lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;.&lt;task_name&gt;.&lt;subtask_index&gt;</li>
      <li>Applied to all metrics that were scoped to a task.</li>
    </ul>
  </li>
  <li>metrics.scope.tm.operator
    <ul>
      <li>默认: &lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;.&lt;operator_name&gt;.&lt;subtask_index&gt;</li>
      <li>Applied to all metrics that were scoped to an operator.</li>
    </ul>
  </li>
</ul>

<p>没有严格的定义变量的数量和顺序, 变量对大小写敏感.</p>

<p>一个 operator 默认的 scope 类似于 localhost.taskmanager.1234.MyJob.MyOperator.0.MyMetric</p>

<p>如果你希望包含 task 名字 但是希望忽略 task manager 的信息, 你可以按如下格式:</p>

<p>metrics.scope.tm.operator: &lt;host&gt;.&lt;job_name&gt;.&lt;task_name&gt;.&lt;operator_name&gt;.&lt;subtask_index&gt;</p>

<p>最终你会看到这样的标识符 localhost.MyJob.MySource_-&gt;_MyOperator.MyOperator.0.MyMetric.</p>

<p>这样的标识符会在同一 job 多次运行时引发冲突. 为避免这一情况最好还是提供唯一的 job 标识(例如 &lt;job_id&gt;) 或者给定 jobs 或者 operators 唯一的名字.</p>

<h3 id="所有变量列表">所有变量列表</h3>

<ul>
  <li>JobManager: &lt;host&gt;</li>
  <li>TaskManager: &lt;host&gt;, &lt;tm_id&gt;</li>
  <li>Job: &lt;job_id&gt;, &lt;job_name&gt;</li>
  <li>Task: &lt;task_id&gt;, &lt;task_name&gt;, ]&lt;task_attempt_id&gt;, &lt;task_attempt_num&gt;, &lt;subtask_index&gt;</li>
  <li>Operator: &lt;operator_name&gt;, &lt;subtask_index&gt;</li>
</ul>

<h2 id="reporter">Reporter</h2>

<p>通过设置 conf/flink-conf.yaml 配置文件, 可以把 Metrics 传给外部的组件.</p>

<ul>
  <li>metrics.reporters: The list of named reporters.</li>
  <li>metrics.reporter.&lt;name&gt;.&lt;config&gt;: Generic setting &lt;config&gt; for the reporter named &lt;name&gt;.</li>
  <li>metrics.reporter.&lt;name&gt;.class: The reporter class to use for the reporter named &lt;name&gt;.</li>
  <li>metrics.reporter.&lt;name&gt;.interval: The reporter interval to use for the reporter named &lt;name&gt;.</li>
</ul>

<p>每个 reporter 都必须包含 class 属性, 一些还可以设置 internal. 下面将会列出各个 reporter 的详细设置.</p>

<p>设置多个 reporter 的例子:</p>

<div class="highlight"><pre><code>metrics.reporters: my_jmx_reporter,my_other_reporter

metrics.reporter.my_jmx_reporter.class: org.apache.flink.metrics.jmx.JMXReporter
metrics.reporter.my_jmx_reporter.port: 9020-9040

metrics.reporter.my_other_reporter.class: org.apache.flink.metrics.graphite.GraphiteReporter
metrics.reporter.my_other_reporter.host: 192.168.1.1
metrics.reporter.my_other_reporter.port: 10000
</code></pre></div>

<p>你可以通过实现 org.apache.flink.metrics.reporter.MetricReporter 接口来写出自己的 reporter. 如果 reporter 需要定时执行的话还得实现 Scheduled 接口.</p>

<p>下面列出了目前支持的 reportre.</p>

<h3 id="jmx-orgapacheflinkmetricsjmxjmxreporter">JMX (org.apache.flink.metrics.jmx.JMXReporter)</h3>

<p>你不需要额外添加依赖, 因为 JMX 已经默认提供但是没有被开启.</p>

<p>参数:</p>

<ul>
  <li>port - JMX 监听端口. 也可以是一个端口范围. 当设定这个值后它将会在 job 或者 task manager 的 log 里进行显示. 如果没有指定端口那么将不会有 JMX 服务开启. Metrics 在本地 JMX 接口仍然可用.</li>
</ul>

<h3 id="ganglia-orgapacheflinkmetricsgangliagangliareporter">Ganglia (org.apache.flink.metrics.ganglia.GangliaReporter)</h3>

<p>依赖:</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>flink-metrics-ganglia<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>参数:</p>

<ul>
  <li>host - the gmond host address configured under udp_recv_channel.bind in gmond.conf</li>
  <li>port - the gmond port configured under udp_recv_channel.port in gmond.conf</li>
  <li>tmax - soft limit for how long an old metric should be retained</li>
  <li>dmax - hard limit for how long an old metric should be retained</li>
  <li>ttl - time-to-live for transmitted UDP packets</li>
  <li>addressingMode - UDP addressing mode to use (UNICAST/MULTICAST)</li>
</ul>

<h3 id="graphite-orgapacheflinkmetricsgraphitegraphitereporter">Graphite (org.apache.flink.metrics.graphite.GraphiteReporter)</h3>

<p>依赖:</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>flink-metrics-graphite<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>参数:</p>

<ul>
  <li>host - Graphite 主机名</li>
  <li>port - Graphite 端口</li>
</ul>

<h3 id="statsd-orgapacheflinkmetricsstatsdstatsdreporter">StatsD (org.apache.flink.metrics.statsd.StatsDReporter)</h3>

<p>依赖:</p>

<div class="highlight"><pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.flink<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>flink-metrics-statsd<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></div>

<p>参数:</p>

<ul>
  <li>host - StatsD 主机名</li>
  <li>port - StatsD 端口</li>
</ul>

<h2 id="系统-metrics">系统 metrics</h2>

<p>Flink 提供如下系统 metrics 给外部使用:</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="text-left" style="width: 20%">Scope</th>
      <th class="text-left">Metrics</th>
      <th class="text-left">Description</th>
    </tr>
  </thead>

  <tbody>
    <tr>
      <th rowspan="1"><strong>JobManager</strong></th>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="19"><strong>TaskManager.Status.JVM</strong></th>
      <td>ClassLoader.ClassesLoaded</td>
      <td>The total number of classes loaded since the start of the JVM.</td>
    </tr>
    <tr>
      <td>ClassLoader.ClassesUnloaded</td>
      <td>The total number of classes unloaded since the start of the JVM.</td>
    </tr>
    <tr>
      <td>GargabeCollector.&lt;garbageCollector&gt;.Count</td>
      <td>The total number of collections that have occurred.</td>
    </tr>
    <tr>
      <td>GargabeCollector.&lt;garbageCollector&gt;.Time</td>
      <td>The total time spent performing garbage collection.</td>
    </tr>
    <tr>
      <td>Memory.Heap.Used</td>
      <td>The amount of heap memory currently used.</td>
    </tr>
    <tr>
      <td>Memory.Heap.Committed</td>
      <td>The amount of heap memory guaranteed to be available to the JVM.</td>
    </tr>
    <tr>
      <td>Memory.Heap.Max</td>
      <td>The maximum amount of heap memory that can be used for memory management.</td>
    </tr>
    <tr>
      <td>Memory.NonHeap.Used</td>
      <td>The amount of non-heap memory currently used.</td>
    </tr>
    <tr>
      <td>Memory.NonHeap.Committed</td>
      <td>The amount of non-heap memory guaranteed to be available to the JVM.</td>
    </tr>
    <tr>
      <td>Memory.NonHeap.Max</td>
      <td>The maximum amount of non-heap memory that can be used for memory management.</td>
    </tr>
    <tr>
      <td>Memory.Direct.Count</td>
      <td>The number of buffers in the direct buffer pool.</td>
    </tr>
    <tr>
      <td>Memory.Direct.MemoryUsed</td>
      <td>The amount of memory used by the JVM for the direct buffer pool.</td>
    </tr>
    <tr>
      <td>Memory.Direct.TotalCapacity</td>
      <td>The total capacity of all buffers in the direct buffer pool.</td>
    </tr>
    <tr>
      <td>Memory.Mapped.Count</td>
      <td>The number of buffers in the mapped buffer pool.</td>
    </tr>
    <tr>
      <td>Memory.Mapped.MemoryUsed</td>
      <td>The amount of memory used by the JVM for the mapped buffer pool.</td>
    </tr>
    <tr>
      <td>Memory.Mapped.TotalCapacity</td>
      <td>The number of buffers in the mapped buffer pool.</td>
    </tr>
    <tr>
      <td>Threads.Count</td>
      <td>The total number of live threads.</td>
    </tr>
    <tr>
      <td>CPU.Load</td>
      <td>The recent CPu usage of the JVM.</td>
    </tr>
    <tr>
      <td>CPU.Time</td>
      <td>The CPU time used by the JVM.</td>
    </tr>
    <tr>
      <th rowspan="1"><strong>Job</strong></th>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <tr>
        <th rowspan="5"><strong>Task</strong></th>
        <td>currentLowWatermark</td>
        <td>The lowest watermark a task has received.</td>
      </tr>
      <tr>
        <td>lastCheckpointDuration</td>
        <td>The time it took to complete the last checkpoint.</td>
      </tr>
      <tr>
        <td>lastCheckpointSize</td>
        <td>The total size of the last checkpoint.</td>
      </tr>
      <tr>
        <td>restartingTime</td>
        <td>The time it took to restart the job.</td>
      </tr>
      <tr>
        <td>numBytesInLocal</td>
        <td>The total number of bytes this task has read from a local source.</td>
      </tr>
      <tr>
        <td>numBytesInRemote</td>
        <td>The total number of bytes this task has read from a remote source.</td>
      </tr>
      <tr>
        <td>numBytesOut</td>
        <td>The total number of bytes this task has emitted.</td>
      </tr>
    </tr>
    <tr>
      <tr>
        <th rowspan="3"><strong>Operator</strong></th>
        <td>numRecordsIn</td>
        <td>The total number of records this operator has received.</td>
      </tr>
      <tr>
        <td>numRecordsOut</td>
        <td>The total number of records this operator has emitted.</td>
      </tr>
      <tr>
        <td>numSplitsProcessed</td>
        <td>The total number of InputSplits this data source has processed.</td>
      </tr>
    </tr>
  </tbody>
</table>


     <div class="footer">
      发现错误？想参与编辑？
      <a href="https://github.com/flink-china/flink-china-doc/edit/1.1.0/apis/metrics.md" target="_blank">
        在 Github 上编辑此页！
      </a>
    </div>
  </div>
  

  
</div>

    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/1.1.0/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <!-- script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script -->

    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?835985ad7943d8c24bc3c1f155b7d4a2";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>


    <!-- Disqus -->
    
  </body>
</html>
